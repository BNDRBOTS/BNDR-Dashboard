<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BNDR Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<style>
/* ============================================================
   BNDR DASHBOARD â€” ELITE 2026 DESIGN SYSTEM
   Palette: Deep Graphite Â· Indigo Violet Â· Polar Ice Â· Ember
   Glassmorphism Â· WCAG AA Â· Responsive Â· Encrypted Â· Modular
   All colors pass 4.5:1 contrast on their respective surfaces.
============================================================ */

/* â”€â”€ Design tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root[data-theme="dark"] {
  /* Surfaces */
  --bg-base:         #0e0f12;
  --bg-layer1:       #14161b;
  --bg-layer2:       #1c1f27;
  --bg-input:        #252932;   /* true grey input surface */
  --glass-bg:        rgba(28,31,39,0.78);
  --glass-border:    rgba(255,255,255,0.07);
  --glass-shine:     rgba(255,255,255,0.03);
  --shadow:          0 8px 40px rgba(0,0,0,0.72);

  /* Accent â€” Indigo-to-Violet spectrum */
  --accent:          #818cf8;   /* indigo-400 */
  --accent-bright:   #a5b4fc;   /* indigo-300 â€” hover/focus */
  --accent-dim:      #4f46e5;   /* indigo-600 â€” bg fills */
  --accent-glow:     rgba(129,140,248,0.14);

  /* Semantic â€” all pass 4.5:1 on layer2 */
  --clr-danger:      #f87171;   /* red-400   â€” #f87171 on #1c1f27 = 5.1:1 âœ“ */
  --clr-warn:        #fb923c;   /* orange-400 â€” 4.6:1 âœ“ â€” NOTE: NOT mustard */
  --clr-success:     #34d399;   /* emerald-400 â€” 5.8:1 âœ“ */
  --clr-info:        #38bdf8;   /* sky-400    â€” 5.2:1 âœ“ */

  /* Semantic bg tints */
  --clr-danger-bg:   rgba(248,113,113,0.09);
  --clr-warn-bg:     rgba(251,146,60,0.09);
  --clr-success-bg:  rgba(52,211,153,0.09);

  /* Text â€” all pass WCAG AA */
  --text-primary:    #e8eaf0;   /* 13.1:1 on bg-base âœ“ */
  --text-secondary:  #9ba3b4;   /* 5.1:1 on bg-layer2 âœ“ */
  --text-muted:      #6b7585;   /* 3.1:1 â€” used ONLY for decorative/non-essential */

  /* Radii / motion */
  --br:    16px;
  --br-sm: 10px;
  --br-xs:  6px;
  --blur:         blur(20px);
  --blur-heavy:   blur(36px);
  --ease:         0.22s cubic-bezier(0.4,0,0.2,1);
}

:root[data-theme="light"] {
  --bg-base:         #f4f5f9;
  --bg-layer1:       #eceef4;
  --bg-layer2:       #e3e6ef;
  --bg-input:        #d8dce8;
  --glass-bg:        rgba(255,255,255,0.72);
  --glass-border:    rgba(0,0,0,0.07);
  --glass-shine:     rgba(255,255,255,0.6);
  --shadow:          0 8px 32px rgba(30,40,80,0.11);

  --accent:          #4f46e5;
  --accent-bright:   #4338ca;
  --accent-dim:      #6366f1;
  --accent-glow:     rgba(79,70,229,0.11);

  --clr-danger:      #dc2626;
  --clr-warn:        #ea580c;
  --clr-success:     #059669;
  --clr-info:        #0284c7;

  --clr-danger-bg:   rgba(220,38,38,0.08);
  --clr-warn-bg:     rgba(234,88,12,0.08);
  --clr-success-bg:  rgba(5,150,105,0.08);

  --text-primary:    #111827;
  --text-secondary:  #374151;
  --text-muted:      #6b7280;

  --br:    16px;
  --br-sm: 10px;
  --br-xs:  6px;
  --blur:         blur(20px);
  --blur-heavy:   blur(36px);
  --ease:         0.22s cubic-bezier(0.4,0,0.2,1);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
  font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg-base);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  transition: background var(--ease), color var(--ease);
}

/* â”€â”€ Ambient glows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ambient { position:fixed; pointer-events:none; z-index:0; border-radius:50%; filter:blur(100px); opacity:0.055; }
.ambient-1 { width:600px; height:600px; background:var(--accent);       top:-160px; right:-120px; }
.ambient-2 { width:480px; height:480px; background:var(--clr-info);     bottom:-100px; left:-90px; opacity:0.04; }
.ambient-3 { width:340px; height:340px; background:var(--clr-success);  top:45%; left:40%; opacity:0.025; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETUP SCREEN â€” first-run password creation
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#setup-screen {
  position:fixed; inset:0; z-index:9999;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  background:var(--bg-base); gap:16px;
}
.setup-orb {
  width:80px; height:80px; border-radius:50%;
  background: conic-gradient(from 0deg, var(--accent), var(--accent-bright), var(--clr-info), var(--accent));
  animation: spin 8s linear infinite;
  box-shadow: 0 0 48px var(--accent-glow);
  display:flex; align-items:center; justify-content:center; font-size:30px;
}
@keyframes spin { to { transform:rotate(360deg); } }
.setup-title  { font-size:2rem; font-weight:900; letter-spacing:-0.05em; color:var(--text-primary); }
.setup-sub    { font-size:0.74rem; letter-spacing:0.16em; text-transform:uppercase; color:var(--text-secondary); }
.setup-warn {
  max-width:290px; padding:11px 16px; border-radius:var(--br-sm);
  background:var(--clr-warn-bg); border:1px solid rgba(251,146,60,0.3);
  font-size:0.76rem; color:var(--clr-warn); line-height:1.55; text-align:center;
}
.setup-fields { display:flex; flex-direction:column; gap:10px; width:290px; }

/* â”€â”€ Lock Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#lock-screen {
  position:fixed; inset:0; z-index:9998;
  display:none; flex-direction:column; align-items:center; justify-content:center;
  background:var(--bg-base); gap:18px;
}
.lock-orb {
  width:88px; height:88px; border-radius:50%;
  background: conic-gradient(from 0deg, var(--accent), var(--accent-bright), var(--clr-info), var(--accent));
  animation: spin 8s linear infinite;
  box-shadow: 0 0 52px var(--accent-glow);
  display:flex; align-items:center; justify-content:center; font-size:34px;
}
.lock-title  { font-size:2.1rem; font-weight:900; letter-spacing:-0.05em; color:var(--text-primary); }
.lock-sub    { font-size:0.76rem; letter-spacing:0.15em; text-transform:uppercase; color:var(--text-secondary); }

/* â”€â”€ Shared form elements (lock + setup) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lock-input, .setup-input {
  width:100%; padding:13px 18px;
  border-radius:var(--br);
  border:1.5px solid var(--glass-border);
  background:var(--bg-input);
  color:var(--text-primary);
  font-size:1rem; outline:none;
  transition:border-color var(--ease), box-shadow var(--ease);
}
.lock-input { text-align:center; letter-spacing:0.28em; font-size:1.1rem; width:280px; }
.setup-input { letter-spacing:0.02em; }
.lock-input:focus, .setup-input:focus {
  border-color:var(--accent);
  box-shadow:0 0 0 3px var(--accent-glow);
}
.lock-btn, .setup-btn {
  width:280px; padding:14px; border-radius:var(--br); border:none;
  background:linear-gradient(135deg, var(--accent), var(--accent-dim));
  color:#fff; font-weight:900; font-size:0.94rem;
  letter-spacing:0.04em; cursor:pointer;
  transition:opacity var(--ease), transform var(--ease), box-shadow var(--ease);
  box-shadow: 0 4px 20px rgba(79,70,229,0.35);
}
.setup-btn { width:100%; }
.lock-btn:hover, .setup-btn:hover { opacity:0.88; transform:translateY(-1px); box-shadow:0 6px 28px rgba(79,70,229,0.45); }
.lock-err, .setup-err { font-size:0.8rem; min-height:18px; color:var(--clr-danger); }

/* â”€â”€ App Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app { display:none; min-height:100vh; position:relative; z-index:1; }

/* â”€â”€ Top Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topnav {
  position:sticky; top:0; z-index:100;
  display:flex; align-items:center; gap:12px;
  padding:0 26px; height:58px;
  background:var(--glass-bg);
  backdrop-filter:var(--blur-heavy);
  -webkit-backdrop-filter:var(--blur-heavy);
  border-bottom:1px solid var(--glass-border);
  box-shadow:var(--shadow);
}
.logo-wrap {
  width:34px; height:34px; border-radius:9px; overflow:hidden;
  cursor:pointer; flex-shrink:0;
  border:1.5px solid var(--glass-border);
  background:var(--bg-layer2);
  display:flex; align-items:center; justify-content:center;
  transition:border-color var(--ease);
}
.logo-wrap:hover { border-color:var(--accent); }
.logo-img { width:100%; height:100%; object-fit:cover; display:none; }
.logo-ph  { font-size:16px; line-height:1; }
#logo-file { display:none; }
.brand { font-size:1.1rem; font-weight:900; letter-spacing:-0.04em; color:var(--accent-bright); flex-shrink:0; }
.nav-spacer { flex:1; }
.nav-time {
  font-size:0.83rem; color:var(--text-secondary);
  font-variant-numeric:tabular-nums; letter-spacing:0.03em; white-space:nowrap;
}
.toggle-btn {
  width:44px; height:24px; border-radius:12px;
  background:var(--bg-layer2); border:1.5px solid var(--glass-border);
  cursor:pointer; position:relative; flex-shrink:0;
  transition:background var(--ease);
}
.toggle-btn::after {
  content:''; position:absolute; top:2px; left:2px;
  width:16px; height:16px; border-radius:50%;
  background:var(--accent);
  transition:transform var(--ease);
}
[data-theme="light"] .toggle-btn::after { transform:translateX(20px); }
.nav-btn {
  background:none; border:none; color:var(--text-secondary);
  cursor:pointer; font-size:1rem; padding:6px 8px;
  border-radius:var(--br-xs);
  transition:color var(--ease), background var(--ease);
}
.nav-btn:hover { color:var(--accent-bright); background:var(--accent-glow); }

/* â”€â”€ Dashboard Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dash {
  display:grid;
  grid-template-columns: 2fr 2fr 1.3fr;
  grid-template-rows: auto auto;
  grid-template-areas:
    "notes  charts  right"
    "links  links   right";
  gap:18px;
  padding:22px 24px 32px;
  max-width:1520px;
  margin:0 auto;
}

/* â”€â”€ Glass Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background:var(--glass-bg);
  backdrop-filter:var(--blur);
  -webkit-backdrop-filter:var(--blur);
  border:1px solid var(--glass-border);
  border-radius:var(--br);
  box-shadow:var(--shadow);
  position:relative; overflow:hidden;
  transition:border-color var(--ease), box-shadow var(--ease);
}
.card::before {
  content:''; position:absolute; inset:0;
  background:linear-gradient(135deg, var(--glass-shine) 0%, transparent 55%);
  pointer-events:none; border-radius:inherit;
}
.card:hover {
  border-color:rgba(129,140,248,0.14);
  box-shadow:0 16px 52px rgba(0,0,0,0.5), 0 0 0 1px rgba(129,140,248,0.08);
}
.card-head {
  display:flex; align-items:center; gap:10px;
  padding:14px 20px 11px;
  border-bottom:1px solid var(--glass-border);
}
.card-icon  { font-size:0.93rem; opacity:0.65; }
.card-title {
  font-size:0.7rem; font-weight:700;
  letter-spacing:0.14em; text-transform:uppercase;
  color:var(--text-secondary); flex:1;
}
.card-acts  { display:flex; gap:6px; align-items:center; flex-wrap:wrap; }
.card-body  { padding:16px 20px 20px; }

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  display:inline-flex; align-items:center; gap:5px;
  padding:6px 13px; border-radius:var(--br-xs);
  border:1px solid var(--glass-border);
  background:var(--bg-layer2); color:var(--text-primary);
  font-size:0.75rem; font-weight:600; cursor:pointer;
  white-space:nowrap;
  transition:background var(--ease), border-color var(--ease), transform var(--ease);
}
.btn:hover { background:var(--bg-base); border-color:var(--accent); transform:translateY(-1px); }
.btn-a {
  background:linear-gradient(135deg, var(--accent), var(--accent-dim));
  color:#fff; border-color:transparent; font-weight:800;
  box-shadow:0 3px 14px rgba(79,70,229,0.3);
}
.btn-a:hover { opacity:0.88; box-shadow:0 4px 18px rgba(79,70,229,0.42); }
.btn-d { border-color:rgba(248,113,113,0.22); color:var(--clr-danger); }
.btn-d:hover { background:var(--clr-danger-bg); }

/* â”€â”€ Inputs (grey surface â€” NOT dark blue) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
input[type="text"],
input[type="password"],
input[type="date"],
input[type="time"],
textarea,
select {
  background:var(--bg-input);
  border:1px solid var(--glass-border);
  border-radius:var(--br-xs);
  color:var(--text-primary);
  outline:none;
  font-family:inherit;
  transition:border-color var(--ease), box-shadow var(--ease);
}
input[type="text"]::placeholder,
input[type="password"]::placeholder,
textarea::placeholder { color:var(--text-secondary); opacity:0.7; }
input[type="text"]:focus,
input[type="password"]:focus,
input[type="date"]:focus,
input[type="time"]:focus,
textarea:focus,
select:focus {
  border-color:var(--accent);
  box-shadow:0 0 0 2px var(--accent-glow);
}
select { cursor:pointer; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notes-card { grid-area:notes; }

.note-meta { display:flex; align-items:center; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
.note-meta input[type="text"] { flex:1; min-width:100px; padding:7px 11px; font-size:0.83rem; }

.pbadge {
  padding:4px 10px; border-radius:20px;
  font-size:0.67rem; font-weight:700; letter-spacing:0.08em;
  text-transform:uppercase; cursor:pointer; border:none;
  opacity:0.35; transition:opacity var(--ease);
}
.pbadge.active { opacity:1; }
.pb-h { background:var(--clr-danger-bg);  color:var(--clr-danger);  border:1px solid rgba(248,113,113,0.3); }
.pb-m { background:var(--clr-warn-bg);    color:var(--clr-warn);    border:1px solid rgba(251,146,60,0.3); }
.pb-l { background:var(--clr-success-bg); color:var(--clr-success); border:1px solid rgba(52,211,153,0.3); }

.note-ta {
  width:100%; min-height:158px;
  padding:12px 14px; font-family:'Fira Mono','Consolas',monospace;
  font-size:0.86rem; line-height:1.68; resize:vertical;
}
.note-bar { display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; align-items:center; }
.note-chars { margin-left:auto; font-size:0.7rem; color:var(--text-secondary); }

.ai-box {
  margin-top:12px; padding:12px 14px; border-radius:var(--br-sm);
  background:linear-gradient(135deg, rgba(129,140,248,0.05), rgba(79,70,229,0.03));
  border:1px solid rgba(129,140,248,0.13); min-height:54px;
}
.ai-label { font-size:0.62rem; font-weight:700; letter-spacing:0.13em; text-transform:uppercase; color:var(--accent-bright); margin-bottom:5px; }
.ai-text  { font-size:0.8rem; color:var(--text-secondary); line-height:1.62; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RIGHT COLUMN â€” Calculator + Calendar/Timer stack
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.right-col { grid-area:right; display:flex; flex-direction:column; gap:18px; }

/* â”€â”€ CALCULATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.calc-card {}
.calc-disp {
  background:var(--bg-layer2); border:1px solid var(--glass-border);
  border-radius:var(--br-sm); padding:14px 16px; margin-bottom:12px; text-align:right;
}
.calc-expr   { font-size:0.72rem; color:var(--text-secondary); min-height:16px; margin-bottom:4px; word-break:break-all; }
.calc-result {
  font-size:1.8rem; font-weight:900; letter-spacing:-0.04em;
  color:var(--text-primary); word-break:break-all;
  transition:color var(--ease);
}
.calc-result.flash { color:var(--accent-bright); }
.calc-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:6px; }
.calc-key {
  padding:13px 4px; border:1px solid var(--glass-border);
  border-radius:var(--br-sm); background:var(--bg-layer2);
  color:var(--text-primary); font-size:0.88rem; font-weight:600;
  cursor:pointer; user-select:none;
  transition:background var(--ease), border-color var(--ease), transform var(--ease);
}
.calc-key:hover  { background:var(--bg-base); border-color:rgba(129,140,248,0.25); transform:scale(1.04); }
.calc-key:active { transform:scale(0.96); }
.calc-key.op  { color:var(--accent-bright); font-weight:700; }
.calc-key.eq  { background:linear-gradient(135deg,var(--accent),var(--accent-dim)); color:#fff; border-color:transparent; font-weight:900; }
.calc-key.clr { color:var(--clr-danger); }
.calc-key.wide { grid-column:span 2; }

/* â”€â”€ CALENDAR / TIMER / ALERTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cal-card {}

.cal-tabs { display:flex; gap:0; border-bottom:1px solid var(--glass-border); }
.cal-tab {
  flex:1; padding:8px 4px; background:none; border:none;
  font-size:0.68rem; font-weight:700; letter-spacing:0.1em;
  text-transform:uppercase; cursor:pointer;
  color:var(--text-secondary);
  border-bottom:2px solid transparent;
  transition:color var(--ease), border-color var(--ease);
}
.cal-tab.active { color:var(--accent-bright); border-bottom-color:var(--accent); }

.cal-panel { display:none; padding:14px 18px 18px; }
.cal-panel.active { display:block; }

/* Calendar mini */
.cal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
.cal-month-lbl { font-size:0.82rem; font-weight:700; color:var(--text-primary); }
.cal-nav {
  background:none; border:none; cursor:pointer;
  color:var(--text-secondary); font-size:1rem; padding:3px 7px;
  border-radius:var(--br-xs); transition:color var(--ease), background var(--ease);
}
.cal-nav:hover { color:var(--accent-bright); background:var(--accent-glow); }
.cal-grid-wrap { display:grid; grid-template-columns:repeat(7,1fr); gap:3px; }
.cal-day-name { font-size:0.6rem; font-weight:700; text-align:center; color:var(--text-secondary); padding:3px 0; letter-spacing:0.06em; }
.cal-day {
  font-size:0.72rem; text-align:center; padding:5px 2px;
  border-radius:6px; cursor:pointer; color:var(--text-primary);
  transition:background var(--ease), color var(--ease);
  position:relative;
}
.cal-day:hover { background:var(--accent-glow); color:var(--accent-bright); }
.cal-day.today { background:var(--accent-glow); color:var(--accent-bright); font-weight:800; }
.cal-day.selected { background:var(--accent); color:#fff; font-weight:800; }
.cal-day.other-month { color:var(--text-muted); }
.cal-day.has-event::after {
  content:''; position:absolute; bottom:2px; left:50%; transform:translateX(-50%);
  width:4px; height:4px; border-radius:50%; background:var(--accent);
}
.cal-day.selected.has-event::after { background:#fff; }

/* Event form */
.evt-form { margin-top:14px; display:flex; flex-direction:column; gap:8px; }
.evt-form input[type="text"],
.evt-form input[type="date"],
.evt-form input[type="time"] {
  width:100%; padding:8px 11px; font-size:0.82rem; border-radius:var(--br-xs);
}
.evt-form-row { display:flex; gap:8px; }
.evt-form-row input { flex:1; min-width:0; }
.evt-list { margin-top:12px; display:flex; flex-direction:column; gap:6px; max-height:160px; overflow-y:auto; }
.evt-item {
  display:flex; align-items:flex-start; gap:8px;
  padding:9px 11px; border-radius:var(--br-sm);
  background:var(--bg-layer2); border:1px solid var(--glass-border);
}
.evt-dot { width:8px; height:8px; border-radius:50%; background:var(--accent); flex-shrink:0; margin-top:4px; }
.evt-dot.alert-fired { background:var(--clr-danger); }
.evt-info { flex:1; min-width:0; }
.evt-title-txt { font-size:0.8rem; font-weight:600; color:var(--text-primary); }
.evt-time-txt  { font-size:0.7rem; color:var(--text-secondary); margin-top:2px; }
.evt-del {
  background:none; border:none; cursor:pointer;
  color:var(--text-muted); font-size:0.75rem; padding:2px 5px;
  border-radius:var(--br-xs); transition:color var(--ease);
}
.evt-del:hover { color:var(--clr-danger); }

/* Timer */
.timer-display {
  text-align:center; padding:20px 0 14px;
  font-size:2.8rem; font-weight:900; letter-spacing:-0.04em;
  font-variant-numeric:tabular-nums; color:var(--text-primary);
  transition:color var(--ease);
}
.timer-display.running { color:var(--accent-bright); }
.timer-display.expired { color:var(--clr-danger); }
.timer-controls { display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-bottom:14px; }
.timer-presets  { display:flex; gap:6px; flex-wrap:wrap; justify-content:center; }
.preset-btn {
  padding:5px 10px; font-size:0.71rem; font-weight:600;
  border-radius:20px; border:1px solid var(--glass-border);
  background:var(--bg-layer2); color:var(--text-secondary);
  cursor:pointer; transition:all var(--ease);
}
.preset-btn:hover { border-color:var(--accent); color:var(--accent-bright); background:var(--accent-glow); }
.timer-custom { display:flex; gap:8px; justify-content:center; margin-top:10px; }
.timer-custom input { width:70px; padding:7px 10px; font-size:0.82rem; text-align:center; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHARTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.charts-card { grid-area:charts; }
.charts-stack { display:flex; flex-direction:column; gap:16px; }
.chart-block {
  background:var(--bg-layer2); border:1px solid var(--glass-border);
  border-radius:var(--br-sm); padding:14px;
}
.chart-lbl { font-size:0.66rem; font-weight:700; letter-spacing:0.12em; text-transform:uppercase; color:var(--text-secondary); margin-bottom:9px; }
.chart-block canvas { max-height:110px; }

.pbars { display:flex; flex-direction:column; gap:9px; }
.pbar-row { display:flex; align-items:center; gap:10px; }
.pbar-name { font-size:0.72rem; color:var(--text-secondary); width:52px; flex-shrink:0; }
.pbar-track { flex:1; height:7px; border-radius:4px; background:var(--bg-base); overflow:hidden; }
.pbar-fill  { height:100%; border-radius:4px; transition:width 0.7s cubic-bezier(0.4,0,0.2,1); }
.pbar-pct   { font-size:0.7rem; color:var(--text-secondary); width:30px; text-align:right; flex-shrink:0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LINKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.links-card { grid-area:links; }
.link-add { display:flex; gap:8px; margin-bottom:14px; flex-wrap:wrap; }
.link-add input[type="text"] { flex:1; min-width:80px; padding:8px 12px; font-size:0.82rem; }

.links-grid {
  display:grid; grid-template-columns:repeat(auto-fill, minmax(270px,1fr));
  gap:8px; max-height:340px; overflow-y:auto; padding-right:2px;
}
.links-grid::-webkit-scrollbar { width:4px; }
.links-grid::-webkit-scrollbar-thumb { background:var(--text-muted); border-radius:4px; }

.link-item {
  display:flex; align-items:center; gap:9px;
  padding:9px 12px; border-radius:var(--br-sm);
  background:var(--bg-layer2); border:1px solid var(--glass-border);
  min-width:0; transition:border-color var(--ease), transform var(--ease);
}
.link-item:hover { border-color:rgba(129,140,248,0.22); transform:translateY(-1px); }
.link-fav  { width:18px; height:18px; border-radius:4px; flex-shrink:0; object-fit:cover; }
.link-name { flex:1; font-size:0.81rem; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.link-name a { color:var(--text-primary); text-decoration:none; }
.link-name a:hover { color:var(--accent-bright); }
.link-actions { display:flex; gap:3px; flex-shrink:0; }
.link-btn {
  background:none; border:none; cursor:pointer;
  color:var(--text-secondary); font-size:0.78rem;
  padding:4px 6px; border-radius:var(--br-xs);
  transition:color var(--ease), background var(--ease);
}
.link-btn:hover     { color:var(--accent-bright); background:var(--accent-glow); }
.link-btn.del:hover { color:var(--clr-danger);    background:var(--clr-danger-bg); }
.links-empty { text-align:center; color:var(--text-secondary); font-size:0.81rem; padding:24px 0; grid-column:1/-1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position:fixed; inset:0; z-index:9000;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(6px);
  display:none; align-items:center; justify-content:center;
  padding:20px;
}
.modal-overlay.open { display:flex; }

.modal {
  background:var(--bg-layer1);
  border:1px solid var(--glass-border);
  border-radius:var(--br);
  box-shadow:0 24px 64px rgba(0,0,0,0.7);
  width:100%; max-width:480px;
  max-height:90vh; overflow-y:auto;
}
.modal-head {
  display:flex; align-items:center; gap:10px;
  padding:18px 22px 14px;
  border-bottom:1px solid var(--glass-border);
  position:sticky; top:0; background:var(--bg-layer1); z-index:1;
}
.modal-title { font-size:1rem; font-weight:800; color:var(--text-primary); flex:1; }
.modal-close {
  background:none; border:none; cursor:pointer;
  color:var(--text-secondary); font-size:1.1rem; padding:4px 8px;
  border-radius:var(--br-xs); transition:color var(--ease), background var(--ease);
}
.modal-close:hover { color:var(--clr-danger); background:var(--clr-danger-bg); }

.modal-body { padding:20px 22px 24px; display:flex; flex-direction:column; gap:20px; }

.settings-section {}
.settings-label {
  font-size:0.65rem; font-weight:700; letter-spacing:0.14em;
  text-transform:uppercase; color:var(--accent-bright); margin-bottom:10px; display:block;
}
.settings-field { display:flex; flex-direction:column; gap:6px; margin-bottom:12px; }
.settings-field label { font-size:0.78rem; font-weight:600; color:var(--text-secondary); }
.settings-field input[type="text"],
.settings-field input[type="password"],
.settings-field textarea { width:100%; padding:9px 13px; font-size:0.84rem; border-radius:var(--br-xs); }
.settings-field textarea { min-height:70px; resize:vertical; font-size:0.82rem; }
.settings-hint { font-size:0.72rem; color:var(--text-secondary); line-height:1.5; }
.settings-divider { height:1px; background:var(--glass-border); }
.settings-warn {
  padding:10px 14px; border-radius:var(--br-sm);
  background:var(--clr-warn-bg); border:1px solid rgba(251,146,60,0.28);
  font-size:0.76rem; color:var(--clr-warn); line-height:1.55;
}
.settings-save-row { display:flex; gap:8px; justify-content:flex-end; }

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast-wrap { position:fixed; bottom:22px; right:22px; z-index:9997; display:flex; flex-direction:column; gap:7px; }
.toast {
  padding:9px 18px; border-radius:var(--br-sm);
  background:var(--glass-bg); backdrop-filter:var(--blur);
  border:1px solid var(--glass-border); color:var(--text-primary);
  font-size:0.8rem; box-shadow:var(--shadow);
  animation:toastIn 0.28s ease, toastOut 0.28s ease 2.5s forwards;
}
.toast.toast-warn    { border-color:rgba(251,146,60,0.3); color:var(--clr-warn); }
.toast.toast-success { border-color:rgba(52,211,153,0.3); color:var(--clr-success); }
@keyframes toastIn  { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:none; } }
@keyframes toastOut { to   { opacity:0; transform:translateY(6px); } }

/* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar       { width:4px; height:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--text-muted); border-radius:4px; }

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width:1200px) {
  .dash {
    grid-template-columns:1fr 1fr;
    grid-template-areas:
      "notes  charts"
      "links  links"
      "right  right";
  }
  .right-col { flex-direction:row; }
  .right-col .card { flex:1; }
}
@media (max-width:680px) {
  .dash {
    grid-template-columns:1fr;
    grid-template-areas:"notes""charts""links""right";
    padding:14px 12px 28px; gap:14px;
  }
  .topnav { padding:0 14px; }
  .right-col { flex-direction:column; }
  .links-grid { grid-template-columns:1fr; max-height:280px; }
  .calc-key   { padding:12px 4px; font-size:0.84rem; }
  .timer-display { font-size:2.2rem; }
}
</style>
</head>
<body>

<div class="ambient ambient-1"></div>
<div class="ambient ambient-2"></div>
<div class="ambient ambient-3"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SETUP SCREEN â€” first-run password creation
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="setup-screen">
  <div class="setup-orb">âŒ¬</div>
  <div class="setup-title">BNDR</div>
  <div class="setup-sub">Create Your Dashboard Password</div>
  <div class="setup-warn">âš  Lost passwords cannot be recovered. There is no reset mechanism. Store it somewhere safe.</div>
  <div class="setup-fields">
    <input id="setup-pwd1" class="setup-input" type="password"
      placeholder="New password" maxlength="64" autocomplete="new-password" spellcheck="false"
      onkeydown="if(event.key==='Enter')document.getElementById('setup-pwd2').focus()">
    <input id="setup-pwd2" class="setup-input" type="password"
      placeholder="Confirm password" maxlength="64" autocomplete="new-password" spellcheck="false"
      onkeydown="if(event.key==='Enter')setupPassword()">
    <button class="setup-btn" onclick="setupPassword()">Create Password &amp; Enter</button>
    <div class="setup-err" id="setup-err"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOCK SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="lock-screen">
  <div class="lock-orb">âŒ¬</div>
  <div class="lock-title">BNDR</div>
  <div class="lock-sub">Dashboard Â· Encrypted</div>
  <input id="lock-pwd" class="lock-input" type="password"
    placeholder="â€¢ â€¢ â€¢ â€¢" maxlength="64"
    autocomplete="off" spellcheck="false"
    onkeydown="if(event.key==='Enter')tryUnlock()">
  <button class="lock-btn" onclick="tryUnlock()">Unlock</button>
  <div class="lock-err" id="lock-err"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">

  <!-- Top Nav -->
  <nav class="topnav">
    <div class="logo-wrap" onclick="document.getElementById('logo-file').click()" title="Upload logo">
      <img  id="logo-img" class="logo-img" alt="logo">
      <span id="logo-ph"  class="logo-ph">â¬¡</span>
    </div>
    <input type="file" id="logo-file" accept="image/*" onchange="handleLogo(event)">
    <div class="brand">BNDR</div>
    <div class="nav-spacer"></div>
    <span id="nav-time" class="nav-time"></span>
    <button class="toggle-btn"  onclick="toggleTheme()" title="Dark / Light" aria-label="Toggle theme"></button>
    <button class="nav-btn"     onclick="saveAll()"      title="Save all"    aria-label="Save all">ğŸ’¾</button>
    <button class="nav-btn"     onclick="confirmClear()" title="Clear storage" aria-label="Clear storage">ğŸ—‘</button>
    <button class="nav-btn"     onclick="openSettings()" title="Settings"    aria-label="Open settings">âš™ï¸</button>
  </nav>

  <!-- Dashboard -->
  <div class="dash">

    <!-- â”€â”€ NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="card notes-card">
      <div class="card-head">
        <span class="card-icon">ğŸ“</span>
        <span class="card-title">Notes</span>
        <div class="card-acts">
          <button class="btn"       onclick="copyNote()">âŒ˜ Copy</button>
          <button class="btn btn-a" onclick="analyzeNote()">âœ¦ AI Prioritize</button>
          <button class="btn"       onclick="exportNoteTxt()">â†“ .txt</button>
          <button class="btn"       onclick="exportNoteJson()">â†“ .json</button>
          <button class="btn btn-d" onclick="clearNote()">â†º</button>
        </div>
      </div>
      <div class="card-body">
        <div class="note-meta">
          <input type="text" id="note-title" placeholder="Note titleâ€¦" maxlength="90"
            style="flex:1;min-width:100px;padding:7px 11px;font-size:0.83rem;">
          <button class="pbadge pb-h" id="pb-h" onclick="setPri('high')">â— High</button>
          <button class="pbadge pb-m" id="pb-m" onclick="setPri('medium')">â— Med</button>
          <button class="pbadge pb-l" id="pb-l" onclick="setPri('low')">â— Low</button>
        </div>
        <textarea class="note-ta" id="note-ta"
          placeholder="Start writingâ€¦" oninput="onNoteInput()"></textarea>
        <div class="note-bar">
          <button class="btn" onclick="saveNote()">ğŸ’¾ Save</button>
          <span class="note-chars" id="note-chars">0 chars</span>
        </div>
        <div class="ai-box">
          <div class="ai-label">âœ¦ AI Insight</div>
          <div class="ai-text" id="ai-text">Press "AI Prioritize" to analyze note contextâ€¦</div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ CHARTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="card charts-card">
      <div class="card-head">
        <span class="card-icon">ğŸ“Š</span>
        <span class="card-title">Progress &amp; Cognitive Load</span>
        <div class="card-acts">
          <button class="btn" onclick="refreshCharts()">â†º</button>
        </div>
      </div>
      <div class="card-body">
        <div class="charts-stack">

          <div class="chart-block">
            <div class="chart-lbl">Weekly Progress</div>
            <canvas id="c-progress"></canvas>
          </div>

          <div class="chart-block">
            <div class="chart-lbl">Cognitive Load Index</div>
            <canvas id="c-cog"></canvas>
          </div>

          <div class="chart-block">
            <div class="chart-lbl">Priority Distribution</div>
            <div class="pbars">
              <div class="pbar-row">
                <span class="pbar-name">High</span>
                <div class="pbar-track"><div class="pbar-fill" id="pb-fill-h" style="width:0%;background:var(--clr-danger)"></div></div>
                <span class="pbar-pct" id="pb-pct-h">0%</span>
              </div>
              <div class="pbar-row">
                <span class="pbar-name">Medium</span>
                <div class="pbar-track"><div class="pbar-fill" id="pb-fill-m" style="width:0%;background:var(--clr-warn)"></div></div>
                <span class="pbar-pct" id="pb-pct-m">0%</span>
              </div>
              <div class="pbar-row">
                <span class="pbar-name">Low</span>
                <div class="pbar-track"><div class="pbar-fill" id="pb-fill-l" style="width:0%;background:var(--clr-success)"></div></div>
                <span class="pbar-pct" id="pb-pct-l">0%</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- â”€â”€ LINKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="card links-card">
      <div class="card-head">
        <span class="card-icon">ğŸ”—</span>
        <span class="card-title">Website Links</span>
        <div class="card-acts">
          <span id="links-cnt" style="font-size:0.7rem;color:var(--text-secondary)">0 links</span>
        </div>
      </div>
      <div class="card-body">
        <div class="link-add">
          <input type="text" id="lbl-in" placeholder="Label (optional)"
            style="flex:1;min-width:80px;padding:8px 12px;font-size:0.82rem;">
          <input type="text" id="url-in" placeholder="https://â€¦"
            style="flex:2;min-width:100px;padding:8px 12px;font-size:0.82rem;"
            onkeydown="if(event.key==='Enter')addLink()">
          <button class="btn btn-a" onclick="addLink()">+ Add</button>
        </div>
        <div class="links-grid" id="links-grid">
          <div class="links-empty">No links yet â€” add one above.</div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ RIGHT COLUMN: Calc + Calendar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="right-col">

      <!-- Calculator -->
      <div class="card calc-card">
        <div class="card-head">
          <span class="card-icon">ğŸ§®</span>
          <span class="card-title">Calculator</span>
          <div class="card-acts">
            <button class="btn" onclick="calcCopyResult()">âŒ˜ Copy</button>
          </div>
        </div>
        <div class="card-body">
          <div class="calc-disp">
            <div class="calc-expr"   id="calc-expr"></div>
            <div class="calc-result" id="calc-result">0</div>
          </div>
          <div class="calc-grid">
            <button class="calc-key clr"  onclick="calcClear()">C</button>
            <button class="calc-key op"   onclick="calcPM()">Â±</button>
            <button class="calc-key op"   onclick="calcIn('%')">%</button>
            <button class="calc-key op"   onclick="calcIn('Ã·')">Ã·</button>

            <button class="calc-key" onclick="calcIn('7')">7</button>
            <button class="calc-key" onclick="calcIn('8')">8</button>
            <button class="calc-key" onclick="calcIn('9')">9</button>
            <button class="calc-key op" onclick="calcIn('Ã—')">Ã—</button>

            <button class="calc-key" onclick="calcIn('4')">4</button>
            <button class="calc-key" onclick="calcIn('5')">5</button>
            <button class="calc-key" onclick="calcIn('6')">6</button>
            <button class="calc-key op" onclick="calcIn('âˆ’')">âˆ’</button>

            <button class="calc-key" onclick="calcIn('1')">1</button>
            <button class="calc-key" onclick="calcIn('2')">2</button>
            <button class="calc-key" onclick="calcIn('3')">3</button>
            <button class="calc-key op" onclick="calcIn('+')">+</button>

            <button class="calc-key wide" onclick="calcIn('0')">0</button>
            <button class="calc-key" onclick="calcIn('.')">.</button>
            <button class="calc-key eq"  onclick="calcEq()">=</button>
          </div>
        </div>
      </div>

      <!-- Calendar / Timer / Alerts -->
      <div class="card cal-card">
        <div class="card-head">
          <span class="card-icon">ğŸ“…</span>
          <span class="card-title">Calendar Â· Timer Â· Alerts</span>
        </div>
        <div class="cal-tabs">
          <button class="cal-tab active" id="tab-cal"   onclick="switchCalTab('cal')">Calendar</button>
          <button class="cal-tab"        id="tab-timer" onclick="switchCalTab('timer')">Timer</button>
          <button class="cal-tab"        id="tab-alerts" id="tab-alerts" onclick="switchCalTab('alerts')">Alerts</button>
        </div>

        <!-- Calendar panel -->
        <div class="cal-panel active" id="panel-cal">
          <div class="cal-header">
            <button class="cal-nav" onclick="calNav(-1)" aria-label="Previous month">â€¹</button>
            <span class="cal-month-lbl" id="cal-month-lbl"></span>
            <button class="cal-nav" onclick="calNav(1)"  aria-label="Next month">â€º</button>
          </div>
          <div class="cal-grid-wrap" id="cal-grid"></div>

          <div class="evt-form" id="evt-form">
            <input type="text"  id="evt-title-in" placeholder="Event titleâ€¦"   maxlength="80" style="width:100%;padding:8px 11px;font-size:0.82rem;">
            <div class="evt-form-row">
              <input type="date" id="evt-date-in"  style="flex:1;padding:8px 11px;font-size:0.82rem;">
              <input type="time" id="evt-time-in"  style="flex:1;padding:8px 11px;font-size:0.82rem;">
            </div>
            <button class="btn btn-a" onclick="addEvent()" style="width:100%;">+ Add Event</button>
          </div>
        </div>

        <!-- Timer panel -->
        <div class="cal-panel" id="panel-timer">
          <div class="timer-display" id="timer-display">00:00:00</div>
          <div class="timer-controls">
            <button class="btn btn-a" id="timer-start-btn" onclick="timerStartStop()">â–¶ Start</button>
            <button class="btn"       onclick="timerReset()">â†º Reset</button>
            <button class="btn"       onclick="timerLap()"   id="timer-lap-btn" style="display:none">âŠ™ Lap</button>
          </div>
          <div class="timer-presets">
            <button class="preset-btn" onclick="setCountdown(5*60)">5 min</button>
            <button class="preset-btn" onclick="setCountdown(10*60)">10 min</button>
            <button class="preset-btn" onclick="setCountdown(25*60)">25 min</button>
            <button class="preset-btn" onclick="setCountdown(45*60)">45 min</button>
            <button class="preset-btn" onclick="setCountdown(60*60)">1 hr</button>
          </div>
          <div class="timer-custom">
            <input type="text" id="timer-h"  placeholder="hh" maxlength="2" style="width:60px;padding:7px;text-align:center;font-size:0.82rem;">
            <input type="text" id="timer-m"  placeholder="mm" maxlength="2" style="width:60px;padding:7px;text-align:center;font-size:0.82rem;">
            <input type="text" id="timer-s"  placeholder="ss" maxlength="2" style="width:60px;padding:7px;text-align:center;font-size:0.82rem;">
            <button class="btn" onclick="setCustomCountdown()">Set</button>
          </div>
          <div id="timer-laps" style="margin-top:10px;max-height:100px;overflow-y:auto;display:flex;flex-direction:column;gap:4px;"></div>
        </div>

        <!-- Alerts panel -->
        <div class="cal-panel" id="panel-alerts">
          <div class="evt-list" id="alerts-list"></div>
          <div style="margin-top:10px;font-size:0.72rem;color:var(--text-secondary);line-height:1.5;">
            Alerts are auto-generated from calendar events. Browser notifications will fire at event time.
          </div>
        </div>

      </div><!-- /cal-card -->

    </div><!-- /right-col -->

  </div><!-- /dash -->
</div><!-- /app -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SETTINGS MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="settings-overlay" onclick="overlayClose(event)">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Settings">
    <div class="modal-head">
      <span style="font-size:1.1rem">âš™ï¸</span>
      <span class="modal-title">Settings</span>
      <button class="modal-close" onclick="closeSettings()" aria-label="Close settings">âœ•</button>
    </div>
    <div class="modal-body">

      <!-- API Key -->
      <div class="settings-section">
        <span class="settings-label">API Configuration</span>
        <div class="settings-field">
          <label for="s-api-key">OpenAI API Key</label>
          <input type="password" id="s-api-key" placeholder="sk-â€¦" autocomplete="off">
        </div>
        <p class="settings-hint">Used by the AI Prioritize feature. Stored encrypted in localStorage. Never transmitted anywhere except direct OpenAI API calls.</p>
      </div>

      <div class="settings-divider"></div>

      <!-- Change Password -->
      <div class="settings-section">
        <span class="settings-label">Change Password</span>
        <div class="settings-warn">âš  Lost passwords cannot be recovered. There is no reset mechanism.</div>
        <div class="settings-field" style="margin-top:12px;">
          <label for="s-pwd-cur">Current Password</label>
          <input type="password" id="s-pwd-cur" placeholder="Current password" autocomplete="off">
        </div>
        <div class="settings-field">
          <label for="s-pwd-new">New Password</label>
          <input type="password" id="s-pwd-new" placeholder="New password" autocomplete="new-password">
        </div>
        <div class="settings-field">
          <label for="s-pwd-con">Confirm New Password</label>
          <input type="password" id="s-pwd-con" placeholder="Confirm new password" autocomplete="new-password">
        </div>
        <div class="lock-err" id="s-pwd-err"></div>
      </div>

      <div class="settings-divider"></div>

      <!-- Danger zone -->
      <div class="settings-section">
        <span class="settings-label">Danger Zone</span>
        <button class="btn btn-d" onclick="confirmClear()" style="width:100%;justify-content:center;padding:9px;">ğŸ—‘ Clear All Dashboard Data</button>
      </div>

      <div class="settings-save-row">
        <button class="btn"   onclick="closeSettings()">Cancel</button>
        <button class="btn btn-a" onclick="saveSettings()">Save Settings</button>
      </div>

    </div>
  </div>
</div>

<div class="toast-wrap" id="toast-wrap"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CRYPTO â€” XOR + base64 (lightweight, obfuscation-grade)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ENC_KEY = 'BNDR_ENC_2026_v2';

function xorEnc(str, k) {
  let o = '';
  for (let i = 0; i < str.length; i++)
    o += String.fromCharCode(str.charCodeAt(i) ^ k.charCodeAt(i % k.length));
  return btoa(unescape(encodeURIComponent(o)));
}
function xorDec(b64, k) {
  try {
    const s = decodeURIComponent(escape(atob(b64)));
    let o = '';
    for (let i = 0; i < s.length; i++)
      o += String.fromCharCode(s.charCodeAt(i) ^ k.charCodeAt(i % k.length));
    return o;
  } catch { return null; }
}
function lsSet(key, val) {
  localStorage.setItem(key, xorEnc(JSON.stringify(val), ENC_KEY));
}
function lsGet(key, fallback) {
  const raw = localStorage.getItem(key);
  if (!raw) return fallback;
  try { return JSON.parse(xorDec(raw, ENC_KEY)) ?? fallback; }
  catch { return fallback; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PASSWORD MANAGEMENT
   â€” stored hashed (djb2 â€” lightweight, no crypto API dep)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function djb2(str) {
  let h = 5381;
  for (let i = 0; i < str.length; i++)
    h = ((h << 5) + h) ^ str.charCodeAt(i);
  return (h >>> 0).toString(36);
}

function getStoredHash() { return lsGet('bndr-pwd-hash', null); }
function setStoredHash(pwd) { lsSet('bndr-pwd-hash', djb2(pwd)); }
function verifyPassword(pwd) { return djb2(pwd) === getStoredHash(); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SETUP SCREEN â€” first run
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function setupPassword() {
  const p1  = document.getElementById('setup-pwd1').value;
  const p2  = document.getElementById('setup-pwd2').value;
  const err = document.getElementById('setup-err');

  if (!p1)        { err.textContent = 'Password cannot be empty.'; return; }
  if (p1 !== p2)  { err.textContent = 'Passwords do not match.';  return; }
  if (p1.length < 4) { err.textContent = 'Minimum 4 characters.'; return; }

  setStoredHash(p1);
  document.getElementById('setup-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  bootApp();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LOCK SCREEN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function tryUnlock() {
  const pwd = document.getElementById('lock-pwd').value;
  const err = document.getElementById('lock-err');
  if (verifyPassword(pwd)) {
    document.getElementById('lock-screen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    bootApp();
  } else {
    err.textContent = 'Incorrect password.';
    document.getElementById('lock-pwd').value = '';
    setTimeout(() => { err.textContent = ''; }, 2200);
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   BOOT â€” decide which screen to show
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(function init() {
  const hash = getStoredHash();
  if (!hash) {
    // First run â€” show setup
    document.getElementById('setup-screen').style.display = 'flex';
    document.getElementById('lock-screen').style.display  = 'none';
  } else {
    // Returning user â€” show lock
    document.getElementById('setup-screen').style.display = 'none';
    document.getElementById('lock-screen').style.display  = 'flex';
    document.getElementById('lock-pwd').focus();
  }
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function bootApp() {
  loadTheme();
  loadLogo();
  loadNote();
  loadLinks();
  initClock();
  initCharts();
  renderPBars();
  initCalendar();
  loadEvents();
  loadSettings();
  startAlertWatcher();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initClock() {
  const el = document.getElementById('nav-time');
  const tick = () => {
    el.textContent = new Date().toLocaleTimeString([], { hour:'2-digit', minute:'2-digit', second:'2-digit' });
  };
  tick(); setInterval(tick, 1000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleTheme() {
  const html = document.documentElement;
  const next = html.dataset.theme === 'dark' ? 'light' : 'dark';
  html.dataset.theme = next;
  lsSet('bndr-theme', next);
  setTimeout(refreshCharts, 250);
}
function loadTheme() {
  document.documentElement.dataset.theme = lsGet('bndr-theme', 'dark');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleLogo(e) {
  const f = e.target.files[0]; if (!f) return;
  const r = new FileReader();
  r.onload = ev => { applyLogo(ev.target.result); lsSet('bndr-logo', ev.target.result); toast('Logo updated'); };
  r.readAsDataURL(f);
}
function applyLogo(src) {
  const img = document.getElementById('logo-img');
  const ph  = document.getElementById('logo-ph');
  img.src = src; img.style.display = 'block'; ph.style.display = 'none';
}
function loadLogo() {
  const s = lsGet('bndr-logo', null); if (s) applyLogo(s);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// notePri tracks the CURRENT unsaved priority state only
// It is NOT used for bar calculations unless the note is saved
let notePri = null;

function setPri(p) {
  notePri = p;
  ['high','medium','low'].forEach(x => {
    document.getElementById('pb-' + x[0])?.classList.toggle('active', x === p);
  });
}

function onNoteInput() {
  document.getElementById('note-chars').textContent =
    document.getElementById('note-ta').value.length + ' chars';
}

function saveNote() {
  if (!notePri) notePri = 'medium'; // only default on explicit save
  lsSet('bndr-note', {
    title:    document.getElementById('note-title').value,
    body:     document.getElementById('note-ta').value,
    priority: notePri,
    ts:       Date.now(),
  });
  renderPBars();
  toast('Note saved âœ“', 'success');
}

function loadNote() {
  const d = lsGet('bndr-note', null); if (!d) return;
  document.getElementById('note-title').value = d.title || '';
  document.getElementById('note-ta').value    = d.body  || '';
  onNoteInput();
  // Only set priority UI if there's actual saved data
  if (d.priority) setPri(d.priority);
}

function clearNote() {
  document.getElementById('note-title').value = '';
  document.getElementById('note-ta').value    = '';
  document.getElementById('ai-text').textContent = 'Press "AI Prioritize" to analyze note contextâ€¦';
  document.getElementById('ai-text').style.color = '';
  notePri = null;
  ['pb-h','pb-m','pb-l'].forEach(id => document.getElementById(id)?.classList.remove('active'));
  onNoteInput();
  toast('Note cleared');
}

function copyNote() {
  const t = document.getElementById('note-ta').value;
  if (!t) { toast('Nothing to copy'); return; }
  navigator.clipboard.writeText(t).then(() => toast('Note copied âŒ˜'));
}

function exportNoteTxt() {
  const title = document.getElementById('note-title').value || 'bndr-note';
  const body  = document.getElementById('note-ta').value;
  if (!body) { toast('Note is empty'); return; }
  triggerDownload(body, title.replace(/\s+/g, '_') + '.txt', 'text/plain');
}

function exportNoteJson() {
  const title    = document.getElementById('note-title').value || 'bndr-note';
  const body     = document.getElementById('note-ta').value;
  const priority = notePri || lsGet('bndr-note', {})?.priority || 'none';
  if (!body) { toast('Note is empty'); return; }
  const payload = JSON.stringify({
    schema:   'bndr-note/1.0',
    title,
    body,
    priority,
    exportedAt: new Date().toISOString(),
  }, null, 2);
  triggerDownload(payload, title.replace(/\s+/g, '_') + '.json', 'application/json');
}

function triggerDownload(content, filename, mime) {
  const a = Object.assign(document.createElement('a'), {
    href:     URL.createObjectURL(new Blob([content], { type: mime })),
    download: filename,
  });
  a.click(); URL.revokeObjectURL(a.href);
}

/* â”€â”€ AI Prioritizer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function analyzeNote() {
  const body  = document.getElementById('note-ta').value.trim();
  const aiEl  = document.getElementById('ai-text');
  const apiKey = lsGet('bndr-api-key', null);

  if (!body) { aiEl.textContent = 'No content to analyze.'; return; }

  aiEl.textContent = 'Analyzingâ€¦'; aiEl.style.color = 'var(--text-secondary)';

  // If API key present, use real OpenAI call; otherwise use local heuristic
  if (apiKey) {
    analyzeWithOpenAI(body, apiKey, aiEl);
  } else {
    analyzeLocal(body, aiEl);
  }
}

function analyzeLocal(body, aiEl) {
  const U = (body.match(/urgent|asap|now|today|deadline|critical|important|immediately|must|required|overdue/gi) || []).length;
  const M = (body.match(/soon|next.?week|follow.?up|plan|review|update|check|schedule|consider/gi) || []).length;
  const D = (body.match(/think|explore|research|analyze|brainstorm|investigate|draft|design|architect/gi) || []).length;
  const A = (body.match(/do|build|create|write|send|call|email|fix|resolve|deploy|push|launch/gi) || []).length;
  const words = body.split(/\s+/).filter(Boolean).length;
  const sents = body.split(/[.!?]+/).filter(Boolean).length;
  const avgSL = words / Math.max(sents, 1);

  const cog = Math.min(100, Math.round((D * 13) + (words * 0.38) + (avgSL * 1.6) + (A * 5)));

  let pri, rationale;
  if      (U >= 2 || (U >= 1 && A >= 2)) { pri = 'high';   rationale = `${U} urgency + ${A} action signals.`; }
  else if (M >= 2 || A >= 3 || (U >= 1)) { pri = 'medium'; rationale = `${M} scheduling + ${A} action items.`; }
  else                                    { pri = 'low';    rationale = 'Exploratory / reference content.'; }

  const cogLabel = cog > 70 ? 'High load' : cog > 40 ? 'Moderate load' : 'Low load';
  const lines = [
    `Priority â†’ ${pri.toUpperCase()} â€” ${rationale}`,
    `Cognitive load: ${cog}/100 (${cogLabel}). ${words}w Â· ${sents} sentence${sents !== 1 ? 's' : ''}.`,
    D > 0 ? `Deep thinking required (${D} analytical signal${D > 1 ? 's' : ''}).` : null,
  ].filter(Boolean).join(' ');

  setTimeout(() => {
    aiEl.textContent = lines;
    aiEl.style.color = 'var(--text-primary)';
    setPri(pri);
    setCogChart(cog);
    renderPBars();
  }, 320);
}

function analyzeWithOpenAI(body, apiKey, aiEl) {
  fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + apiKey },
    body: JSON.stringify({
      model: 'gpt-3.5-turbo',
      messages: [{
        role: 'system',
        content: 'You are a productivity AI. Analyze the note and respond with exactly: priority (high/medium/low), cognitive load 0-100, and a single insight sentence. Format: PRIORITY: x | LOAD: n | INSIGHT: text'
      }, { role: 'user', content: body }],
      max_tokens: 120,
      temperature: 0.3,
    }),
  })
  .then(r => r.json())
  .then(data => {
    const txt = data?.choices?.[0]?.message?.content || '';
    const priM  = txt.match(/PRIORITY:\s*(high|medium|low)/i);
    const loadM  = txt.match(/LOAD:\s*(\d+)/i);
    const insM   = txt.match(/INSIGHT:\s*(.+)/i);

    const pri   = priM?.[1]?.toLowerCase() || 'medium';
    const cog   = Math.min(100, parseInt(loadM?.[1] || '40', 10));
    const insight = insM?.[1]?.trim() || txt;

    aiEl.textContent = `Priority â†’ ${pri.toUpperCase()} | Cognitive load: ${cog}/100 | ${insight}`;
    aiEl.style.color = 'var(--text-primary)';
    setPri(pri);
    setCogChart(cog);
    renderPBars();
  })
  .catch(() => {
    aiEl.textContent = 'API error â€” falling back to local analysis.';
    analyzeLocal(body, aiEl);
  });
}

/* â”€â”€ Priority Bars â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
// Uses ONLY the saved note's priority â€” no double count, no default pollution
function renderPBars() {
  const saved  = lsGet('bndr-note', null);
  const counts = { high: 0, medium: 0, low: 0 };

  if (saved?.priority && counts.hasOwnProperty(saved.priority)) {
    counts[saved.priority] = 1;
  }

  const total = Object.values(counts).reduce((a, b) => a + b, 0);

  const map = { high: 'h', medium: 'm', low: 'l' };
  Object.entries(counts).forEach(([p, v]) => {
    const pct = total > 0 ? Math.round((v / total) * 100) : 0;
    document.getElementById('pb-fill-' + map[p]).style.width = pct + '%';
    document.getElementById('pb-pct-'  + map[p]).textContent = pct + '%';
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHARTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let cProgress = null, cCog = null;

function chartCols() {
  const dark = document.documentElement.dataset.theme === 'dark';
  return {
    grid:  dark ? 'rgba(255,255,255,0.04)' : 'rgba(0,0,0,0.06)',
    tick:  dark ? '#9ba3b4' : '#374151',
    line:  dark ? '#818cf8' : '#4f46e5',
    fill:  dark ? 'rgba(129,140,248,0.10)' : 'rgba(79,70,229,0.09)',
  };
}

function initCharts() {
  const col  = chartCols();

  const ctxP = document.getElementById('c-progress').getContext('2d');
  cProgress = new Chart(ctxP, {
    type: 'line',
    data: {
      labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
      datasets: [{
        data: [28,54,42,78,63,88,71],
        borderColor:       col.line,
        backgroundColor:   col.fill,
        borderWidth: 2,
        pointBackgroundColor: col.line,
        pointRadius: 3,
        tension: 0.44,
        fill: true,
      }],
    },
    options: {
      responsive: true, maintainAspectRatio: true,
      plugins: { legend: { display: false } },
      scales: {
        x: { grid: { color: col.grid }, ticks: { color: col.tick, font: { size: 9 } } },
        y: { grid: { color: col.grid }, ticks: { color: col.tick, font: { size: 9 } }, min: 0, max: 100 },
      },
    },
  });

  const ctxC = document.getElementById('c-cog').getContext('2d');
  cCog = new Chart(ctxC, {
    type: 'doughnut',
    // Start at 0% filled â€” no phantom data
    data: {
      datasets: [{
        data: [0, 100],
        backgroundColor: [col.line, 'rgba(129,140,248,0.07)'],
        borderWidth: 0,
      }],
    },
    options: {
      responsive: true, maintainAspectRatio: true, cutout: '74%',
      plugins: {
        legend: { display: false },
        tooltip: { callbacks: { label: ctx => ctx.parsed + '%' } },
      },
    },
  });
}

function setCogChart(val) {
  if (!cCog) return;
  const dark   = document.documentElement.dataset.theme === 'dark';
  const danger = dark ? 'rgba(248,113,113,0.85)' : 'rgba(220,38,38,0.85)';
  const warn   = dark ? 'rgba(251,146,60,0.85)'  : 'rgba(234,88,12,0.85)';
  const ok     = dark ? 'rgba(129,140,248,0.85)' : 'rgba(79,70,229,0.85)';
  cCog.data.datasets[0].data         = [val, 100 - val];
  cCog.data.datasets[0].backgroundColor[0] =
    val > 70 ? danger : val > 40 ? warn : ok;
  cCog.update();
}

function refreshCharts() {
  if (cProgress) { cProgress.destroy(); cProgress = null; }
  if (cCog)      { cCog.destroy();      cCog      = null; }
  initCharts(); renderPBars();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LINKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let links = [];

function loadLinks() { links = lsGet('bndr-links', []); renderLinks(); }

function addLink() {
  let url   = document.getElementById('url-in').value.trim();
  const lbl = document.getElementById('lbl-in').value.trim();
  if (!url) { toast('Enter a URL first'); return; }
  if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
  links.push({ id: Date.now(), label: lbl || url, url });
  lsSet('bndr-links', links);
  renderLinks();
  document.getElementById('url-in').value = '';
  document.getElementById('lbl-in').value = '';
  toast('Link added âœ“', 'success');
}

function removeLink(id) {
  links = links.filter(l => l.id !== id);
  lsSet('bndr-links', links);
  renderLinks();
}

function copyLink(url) {
  navigator.clipboard.writeText(url).then(() => toast('URL copied âŒ˜'));
}

function fav(url) {
  try { return `https://www.google.com/s2/favicons?sz=32&domain_url=${new URL(url).origin}`; }
  catch { return ''; }
}

function esc(s) {
  return String(s)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function renderLinks() {
  const grid  = document.getElementById('links-grid');
  const count = document.getElementById('links-cnt');
  count.textContent = links.length + ' link' + (links.length !== 1 ? 's' : '');
  if (!links.length) {
    grid.innerHTML = '<div class="links-empty">No links yet â€” add one above.</div>';
    return;
  }
  grid.innerHTML = links.map(l => `
    <div class="link-item">
      <img class="link-fav" src="${fav(l.url)}" alt="" onerror="this.style.display='none'">
      <span class="link-name"><a href="${esc(l.url)}" target="_blank" rel="noopener noreferrer">${esc(l.label)}</a></span>
      <div class="link-actions">
        <button class="link-btn" onclick="copyLink('${esc(l.url)}')" title="Copy URL">âŒ˜</button>
        <button class="link-btn del" onclick="removeLink(${l.id})" title="Remove">âœ•</button>
      </div>
    </div>
  `).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALCULATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let cExpr = '', cDone = false;

function calcIn(v) {
  const ops = ['+','âˆ’','Ã—','Ã·','%'];
  if (cDone && !ops.includes(v)) cExpr = '';
  cDone = false;
  cExpr += v;
  updCalc();
}
function calcPM() {
  const m = cExpr.match(/(-?\d+\.?\d*)$/);
  if (m) { cExpr = cExpr.slice(0, cExpr.length - m[0].length) + String(-parseFloat(m[0])); updCalc(); }
}
function calcClear() {
  cExpr = ''; cDone = false;
  document.getElementById('calc-expr').textContent   = '';
  document.getElementById('calc-result').textContent = '0';
  document.getElementById('calc-result').classList.remove('flash');
}
function calcEq() {
  if (!cExpr) return;
  try {
    const safe = cExpr.replace(/Ã—/g,'*').replace(/Ã·/g,'/').replace(/âˆ’/g,'-');
    // eslint-disable-next-line no-new-func
    const res = Function('"use strict"; return (' + safe + ')')();
    document.getElementById('calc-expr').textContent   = cExpr + ' =';
    document.getElementById('calc-result').textContent = parseFloat(res.toFixed(10)).toString();
    document.getElementById('calc-result').classList.add('flash');
    setTimeout(() => document.getElementById('calc-result').classList.remove('flash'), 600);
    cExpr = res.toString(); cDone = true;
  } catch {
    document.getElementById('calc-result').textContent = 'Error';
    cExpr = '';
  }
}
function updCalc() {
  document.getElementById('calc-expr').textContent   = cExpr;
  document.getElementById('calc-result').textContent = cExpr || '0';
}
function calcCopyResult() {
  const r = document.getElementById('calc-result').textContent;
  navigator.clipboard.writeText(r).then(() => toast('Result copied âŒ˜'));
}

document.addEventListener('keydown', e => {
  if (document.getElementById('lock-screen').style.display   === 'flex') return;
  if (document.getElementById('setup-screen').style.display  === 'flex') return;
  if (document.getElementById('settings-overlay').classList.contains('open')) return;
  const tag = document.activeElement.tagName;
  if (tag === 'INPUT' || tag === 'TEXTAREA') return;
  const k = e.key;
  if ('0123456789.'.includes(k))       calcIn(k);
  else if (k === '+')                  calcIn('+');
  else if (k === '-')                  calcIn('âˆ’');
  else if (k === '*')                  calcIn('Ã—');
  else if (k === '/') { e.preventDefault(); calcIn('Ã·'); }
  else if (k === 'Enter' || k === '=') calcEq();
  else if (k === 'Backspace')          { cExpr = cExpr.slice(0,-1); updCalc(); }
  else if (k === 'Escape')             calcClear();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let calYear, calMonth, calSelectedDate = null;
let calEvents = [];

function initCalendar() {
  const now = new Date();
  calYear  = now.getFullYear();
  calMonth = now.getMonth();
  renderCal();
  // Pre-fill date input with today
  const pad = n => String(n).padStart(2, '0');
  document.getElementById('evt-date-in').value =
    `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
}

function calNav(dir) {
  calMonth += dir;
  if (calMonth > 11) { calMonth = 0;  calYear++; }
  if (calMonth < 0)  { calMonth = 11; calYear--; }
  renderCal();
}

function renderCal() {
  const months = ['January','February','March','April','May','June',
                  'July','August','September','October','November','December'];
  document.getElementById('cal-month-lbl').textContent = `${months[calMonth]} ${calYear}`;

  const grid  = document.getElementById('cal-grid');
  const today = new Date();
  const days  = ['Su','Mo','Tu','We','Th','Fr','Sa'];
  const eventDates = new Set(calEvents.map(e => e.date));

  let html = days.map(d => `<span class="cal-day-name">${d}</span>`).join('');

  const first    = new Date(calYear, calMonth, 1).getDay();
  const lastDay  = new Date(calYear, calMonth + 1, 0).getDate();
  const prevLast = new Date(calYear, calMonth, 0).getDate();

  for (let i = 0; i < first; i++) {
    const d = prevLast - first + 1 + i;
    html += `<span class="cal-day other-month">${d}</span>`;
  }
  for (let d = 1; d <= lastDay; d++) {
    const pad  = n => String(n).padStart(2,'0');
    const dateStr = `${calYear}-${pad(calMonth+1)}-${pad(d)}`;
    const isToday = today.getFullYear() === calYear && today.getMonth() === calMonth && today.getDate() === d;
    const isSel   = calSelectedDate === dateStr;
    const hasEvt  = eventDates.has(dateStr);
    const cls = ['cal-day',
      isToday   ? 'today'      : '',
      isSel     ? 'selected'   : '',
      hasEvt    ? 'has-event'  : '',
    ].filter(Boolean).join(' ');
    html += `<span class="${cls}" onclick="calSelectDay('${dateStr}')" data-date="${dateStr}">${d}</span>`;
  }
  const remaining = 42 - first - lastDay;
  for (let d = 1; d <= remaining; d++) {
    html += `<span class="cal-day other-month">${d}</span>`;
  }
  grid.innerHTML = html;
}

function calSelectDay(dateStr) {
  calSelectedDate = dateStr;
  document.getElementById('evt-date-in').value = dateStr;
  renderCal();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVENTS & ALERTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadEvents() {
  calEvents = lsGet('bndr-events', []);
  renderCal();
  renderAlertsList();
}

function addEvent() {
  const title = document.getElementById('evt-title-in').value.trim();
  const date  = document.getElementById('evt-date-in').value;
  const time  = document.getElementById('evt-time-in').value;
  if (!title) { toast('Enter an event title'); return; }
  if (!date)  { toast('Pick a date');          return; }
  calEvents.push({ id: Date.now(), title, date, time: time || null, alerted: false });
  lsSet('bndr-events', calEvents);
  document.getElementById('evt-title-in').value = '';
  renderCal();
  renderAlertsList();
  requestNotifPermission();
  toast('Event added âœ“', 'success');
}

function removeEvent(id) {
  calEvents = calEvents.filter(e => e.id !== id);
  lsSet('bndr-events', calEvents);
  renderCal();
  renderAlertsList();
}

function renderAlertsList() {
  const list = document.getElementById('alerts-list');
  const sorted = [...calEvents].sort((a, b) => a.date.localeCompare(b.date));
  if (!sorted.length) {
    list.innerHTML = '<div class="links-empty">No events yet.</div>';
    return;
  }
  list.innerHTML = sorted.map(e => `
    <div class="evt-item">
      <span class="evt-dot ${e.alerted ? 'alert-fired' : ''}"></span>
      <div class="evt-info">
        <div class="evt-title-txt">${esc(e.title)}</div>
        <div class="evt-time-txt">${e.date}${e.time ? ' at ' + e.time : ''}</div>
      </div>
      <button class="evt-del" onclick="removeEvent(${e.id})" title="Remove event">âœ•</button>
    </div>
  `).join('');
}

function requestNotifPermission() {
  if ('Notification' in window && Notification.permission === 'default') {
    Notification.requestPermission();
  }
}

let alertWatchInterval = null;
function startAlertWatcher() {
  if (alertWatchInterval) clearInterval(alertWatchInterval);
  alertWatchInterval = setInterval(checkAlerts, 30000);
  checkAlerts();
}

function checkAlerts() {
  const now = new Date();
  const pad = n => String(n).padStart(2,'0');
  const todayStr = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}`;
  const nowTime  = `${pad(now.getHours())}:${pad(now.getMinutes())}`;

  let changed = false;
  calEvents.forEach(e => {
    if (e.alerted) return;
    const isToday = e.date === todayStr;
    const timeMatch = !e.time || e.time <= nowTime;
    if (isToday && timeMatch) {
      e.alerted = true;
      changed   = true;
      fireAlert(e);
    }
  });
  if (changed) {
    lsSet('bndr-events', calEvents);
    renderAlertsList();
  }
}

function fireAlert(evt) {
  toast(`ğŸ”” ${evt.title}`, 'warn');
  if ('Notification' in window && Notification.permission === 'granted') {
    new Notification('BNDR Alert', { body: evt.title, icon: '' });
  }
}

/* â”€â”€ Calendar Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function switchCalTab(name) {
  ['cal','timer','alerts'].forEach(t => {
    document.getElementById('tab-'   + t).classList.toggle('active', t === name);
    document.getElementById('panel-' + t).classList.toggle('active', t === name);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMER / STOPWATCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let timerInterval = null;
let timerRunning  = false;
let timerSeconds  = 0;
let timerMode     = 'stopwatch'; // 'stopwatch' | 'countdown'
let timerCountdownFrom = 0;
let lapCount = 0;
let lastLapTime = 0;

function fmtTime(s) {
  const h = Math.floor(s / 3600);
  const m = Math.floor((s % 3600) / 60);
  const sec = s % 60;
  const pad = n => String(n).padStart(2,'0');
  return `${pad(h)}:${pad(m)}:${pad(sec)}`;
}

function updateTimerDisplay() {
  const el  = document.getElementById('timer-display');
  const val = timerMode === 'countdown' ? Math.max(0, timerCountdownFrom - timerSeconds) : timerSeconds;
  el.textContent = fmtTime(val);
  el.className   = 'timer-display' + (timerRunning ? ' running' : '') + (timerMode === 'countdown' && val === 0 && timerSeconds > 0 ? ' expired' : '');
}

function timerStartStop() {
  const btn = document.getElementById('timer-start-btn');
  const lap = document.getElementById('timer-lap-btn');
  if (timerRunning) {
    clearInterval(timerInterval); timerRunning = false;
    btn.textContent = 'â–¶ Resume'; lap.style.display = 'none';
  } else {
    timerRunning = true;
    btn.textContent = 'â¸ Pause'; lap.style.display = '';
    timerInterval = setInterval(() => {
      timerSeconds++;
      if (timerMode === 'countdown' && timerSeconds >= timerCountdownFrom) {
        clearInterval(timerInterval); timerRunning = false;
        btn.textContent = 'â–¶ Start'; lap.style.display = 'none';
        toast('â± Timer finished!', 'warn');
        if ('Notification' in window && Notification.permission === 'granted')
          new Notification('BNDR Timer', { body: 'Timer finished!' });
      }
      updateTimerDisplay();
    }, 1000);
  }
}

function timerReset() {
  clearInterval(timerInterval); timerRunning = false; timerSeconds = 0;
  lapCount = 0; lastLapTime = 0;
  document.getElementById('timer-start-btn').textContent = 'â–¶ Start';
  document.getElementById('timer-lap-btn').style.display = 'none';
  document.getElementById('timer-laps').innerHTML = '';
  updateTimerDisplay();
}

function timerLap() {
  if (!timerRunning) return;
  lapCount++;
  const lapTime = timerSeconds - lastLapTime;
  lastLapTime   = timerSeconds;
  const el = document.getElementById('timer-laps');
  const row = Object.assign(document.createElement('div'), {
    style: 'display:flex;justify-content:space-between;font-size:0.72rem;padding:4px 8px;border-radius:6px;background:var(--bg-layer2);color:var(--text-secondary)',
    innerHTML: `<span>Lap ${lapCount}</span><span>${fmtTime(lapTime)}</span><span>${fmtTime(timerSeconds)}</span>`,
  });
  el.prepend(row);
}

function setCountdown(secs) {
  timerReset();
  timerMode = 'countdown'; timerCountdownFrom = secs;
  updateTimerDisplay();
}

function setCustomCountdown() {
  const h = parseInt(document.getElementById('timer-h').value, 10) || 0;
  const m = parseInt(document.getElementById('timer-m').value, 10) || 0;
  const s = parseInt(document.getElementById('timer-s').value, 10) || 0;
  const total = (h * 3600) + (m * 60) + s;
  if (!total) { toast('Enter a valid time'); return; }
  setCountdown(total);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openSettings() {
  loadSettings();
  document.getElementById('settings-overlay').classList.add('open');
}
function closeSettings() {
  document.getElementById('settings-overlay').classList.remove('open');
  // Clear password fields on close
  ['s-pwd-cur','s-pwd-new','s-pwd-con'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('s-pwd-err').textContent = '';
}
function overlayClose(e) {
  if (e.target === document.getElementById('settings-overlay')) closeSettings();
}

function loadSettings() {
  const apiKey = lsGet('bndr-api-key', '');
  document.getElementById('s-api-key').value = apiKey ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' : '';
}

function saveSettings() {
  let changed = false;
  const errEl = document.getElementById('s-pwd-err');
  errEl.textContent = '';

  // API key â€” only save if user typed something new (not the masked placeholder)
  const rawApi = document.getElementById('s-api-key').value.trim();
  if (rawApi && rawApi !== 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢') {
    lsSet('bndr-api-key', rawApi);
    changed = true;
  }

  // Password change
  const cur = document.getElementById('s-pwd-cur').value;
  const nw  = document.getElementById('s-pwd-new').value;
  const con = document.getElementById('s-pwd-con').value;

  if (cur || nw || con) {
    if (!verifyPassword(cur))    { errEl.textContent = 'Current password is incorrect.';  return; }
    if (!nw)                     { errEl.textContent = 'New password cannot be empty.';    return; }
    if (nw.length < 4)           { errEl.textContent = 'Minimum 4 characters.';            return; }
    if (nw !== con)              { errEl.textContent = 'New passwords do not match.';      return; }
    setStoredHash(nw);
    changed = true;
    toast('Password changed âœ“', 'success');
  }

  if (changed) {
    toast('Settings saved âœ“', 'success');
    closeSettings();
  } else {
    toast('No changes to save');
    closeSettings();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE / CLEAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveAll() {
  saveNote();
  lsSet('bndr-links', links);
  lsSet('bndr-events', calEvents);
  toast('All data saved ğŸ’¾', 'success');
}

function confirmClear() {
  if (!confirm('Clear ALL saved dashboard data? This cannot be undone.\n\nNote: This will NOT clear your password â€” you will still be able to log in.')) return;
  // Preserve password hash and theme
  const hash  = getStoredHash();
  const theme = lsGet('bndr-theme', 'dark');
  localStorage.clear();
  if (hash)  lsSet('bndr-pwd-hash', djb2.__source ? null : (() => { lsSet('bndr-pwd-hash', hash); return null; })());
  // Restore hash directly
  localStorage.setItem('bndr-pwd-hash', xorEnc(JSON.stringify(hash), ENC_KEY));
  lsSet('bndr-theme', theme);
  links = []; calEvents = [];
  renderLinks(); clearNote(); renderAlertsList(); renderCal();
  toast('Storage cleared (password preserved)');
  closeSettings();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toast(msg, type) {
  const w = document.getElementById('toast-wrap');
  const t = Object.assign(document.createElement('div'), {
    className:   'toast' + (type ? ' toast-' + type : ''),
    textContent: msg,
  });
  w.appendChild(t);
  setTimeout(() => t.remove(), 2900);
}
</script>
</body>
</html>
